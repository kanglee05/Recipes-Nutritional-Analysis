# Recipes and Ratings Nutritional Statistical Analysis

Recipes and Ratings Nutritional Statistical Analysis is a comprehensive data science project conducted at UCSD. The project consists of data wrangling, various analysis including EDA and hypothesis testing, creation of baseline and final models, and concluding with fairness analysis. The primary focus of the project is to investigate the nutritional values in recipes, seeing if they differ by factors such as season and preparation time, as well as to predict the calories count for recipes using the nutritional values.

By: Kang Lee, Jacob Kavanal

## Introduction

### General Introduction

Every recipe comes with various information such as its ingredients, steps, preparation time, and nutrition. Nutritional information for recipes comes in the form of calories, total fat, sugar, sodium, protein, saturated fat, and carbohydrates. This information is often a good indicator of how healthy a recipe is. Recipes with a good amount protein, calories, and carbohydrates are generally healthy while ones with a lot of sodium, sugar, and saturated fat may cause weight gain or high blood pressure.

Our project consists of two datasets: Recipes and Ratings from food.com. It was originally scraped and used by the authors of a recommender systems paper. Our datasets are only a subset of the raw data used in the original report since the original data is quite large. The Recipes dataset has over 80,000 entries while the Ratings dataset has over 700,000 entries.

We left merged the two datasets and filled all ratings of `0` with `np.nan`. Ratings of 0 are likely missing or placeholder data, probably for recipes with no ratings. We replaced the 0s with `np.nan` to avoid skewing the average rating for recipes and for more accurate analysis. Then, we found the average rating per recipe, as a Series. Finally, we left merged the resulting Series back into the Recipes dataset.

The primary question we aimed to answer was: **Can we predict the calories of recipes by training a regression model on the other nutritional values?** This question interested us since we care about the nutritional value of the food we cook and consume. We were also interested in seeing how accurate the calorie values of these recipes are across the dataset in relation to other nutritional values. We also want to use data analysis techniques to see how nutritional values differ by yearly seasons and cooking time.

### Introduction of Columns

The dataset introduces several arrays of columns featuring recipe information from thousands of recipes posted since 2008. There are 83,782 rows in the dataset, and here is a description of the key columns:

- `name`: This column represents the name of the recipe.

- `id`: This column represents the unique identifier for each recipe. It allows us to distinguish between different recipes in the dataset.

- `minutes`: The 'minutes' column represents the number of minutes it takes to prepare that recipe.

- `contributor_id`: This column represents the unique identifier for the person that posted this recipe. People may post multiple recipes.

- `submitted`: This column represents the date the recipe was posted. It is in the format: year-month-day.

- `tags`: The 'tags' column represents a list of tags that makes the recipes easily filterable for people looking for a specific type of recipe such as 'american' or 'chinese'.

- `nutrition`: The 'nutrition' column represents a list of nutritional information in the form: [calories (#), total fat (PDV), sugar (PDV), sodium (PDV), protein (PDV), saturated fat (PDV), carbohydrates (PDV)]; PDV stands for “percentage of daily value”.

- `n_steps`: This column represents the number of steps the recipe requires.

- `steps`: The 'steps' column represents a list the steps needed to prepare to recipe.

- `description`: The 'description' column represents a description or comment of the recipe uploaded by the contributor.

- `ingredients`: The 'ingredients' column represents a list of ingredients needed to prepare the recipe.

- `n_ingredients`: This column represents the number of ingredidents in the recipe.

- `avg_rating`: The 'avg_rating' column represents average rating of the recipe as a float between 0 and 5.


## Data Cleaning and Exploratory Data Analysis

### Data Cleaning

First, we checked for missing values in the dataset, we found that the `name`, `description`, and `avg_rating` columns had missing values. We found the recipe that had the missing name and based on the description, we concluded that it was a recipe for Salad Vinegarette and filled in the missing name. For all the missing descriptions, we filled it in with 'No description available'. We left the missing average ratings as is to avoid skewing the data.

To perform analysis on the nutritional values seperately, we split the nutrition column to 6 columns. These columns are `total fat (PDV)`, `saturated fat (PDV)`, `sugar (PDV)`, `sodium (PDV)`, `protein (PDV)`, `carbohydrates (PDV)`. PDV means Percent of Daily Value which is the recommended daily intake per person. Furthermore, we converted the `submitted` column to time series and created a new column called `season` for winter, spring, summer, and fall based on the month the recipe was uploaded.

Below is the head of our cleaned Recipes dataframe.

|    | name                                 |     id |   minutes |   contributor_id | submitted           | tags                                                                                                                                                                                                                                                                                               | nutrition                                     |   n_steps | steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | description                                                                                                                                                                                                                                                                                                                                                                       | ingredients                                                                                                                                                                                                                             |   n_ingredients |   avg_rating |   calories |   total fat (PDV) |   sugar (PDV) |   sodium (PDV) |   protein (PDV) |   saturated fat (PDV) |   carbohydrates (PDV) |   month | season   |
|----|--------------------------------------|--------|-----------|------------------|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------|--------------|------------|-------------------|---------------|----------------|-----------------|-----------------------|-----------------------|---------|----------|
|  0 | 1 brownies in the world    best ever | 333281 |        40 |           985201 | 2008-10-27 00:00:00 | ['60-minutes-or-less', 'time-to-make', 'course', 'main-ingredient', 'preparation', 'for-large-groups', 'desserts', 'lunch', 'snacks', 'cookies-and-brownies', 'chocolate', 'bar-cookies', 'brownies', 'number-of-servings']                                                                        | [138.4, 10.0, 50.0, 3.0, 3.0, 19.0, 6.0]      |        10 | ['heat the oven to 350f and arrange the rack in the middle', 'line an 8-by-8-inch glass baking dish with aluminum foil', 'combine chocolate and butter in a medium saucepan and cook over medium-low heat , stirring frequently , until evenly melted', 'remove from heat and let cool to room temperature', 'combine eggs , sugar , cocoa powder , vanilla extract , espresso , and salt in a large bowl and briefly stir until just evenly incorporated', 'add cooled chocolate and mix until uniform in color', 'add flour and stir until just incorporated', 'transfer batter to the prepared baking dish', 'bake until a tester inserted in the center of the brownies comes out clean , about 25 to 30 minutes', 'remove from the oven and cool completely before cutting']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | these are the most; chocolatey, moist, rich, dense, fudgy, delicious brownies that you'll ever make.....sereiously! there's no doubt that these will be your fav brownies ever for you can add things to them or make them plain.....either way they're pure heaven!                                                                                                              | ['bittersweet chocolate', 'unsalted butter', 'eggs', 'granulated sugar', 'unsweetened cocoa powder', 'vanilla extract', 'brewed espresso', 'kosher salt', 'all-purpose flour']                                                          |               9 |            4 |      138.4 |                10 |            50 |              3 |               3 |                    19 |                     6 |      10 | fall     |
|  1 | 1 in canada chocolate chip cookies   | 453467 |        45 |          1848091 | 2011-04-11 00:00:00 | ['60-minutes-or-less', 'time-to-make', 'cuisine', 'preparation', 'north-american', 'for-large-groups', 'canadian', 'british-columbian', 'number-of-servings']                                                                                                                                      | [595.1, 46.0, 211.0, 22.0, 13.0, 51.0, 26.0]  |        12 | ['pre-heat oven the 350 degrees f', 'in a mixing bowl , sift together the flours and baking powder', 'set aside', 'in another mixing bowl , blend together the sugars , margarine , and salt until light and fluffy', 'add the eggs , water , and vanilla to the margarine / sugar mixture and mix together until well combined', 'add in the flour mixture to the wet ingredients and blend until combined', 'scrape down the sides of the bowl and add the chocolate chips', 'mix until combined', 'scrape down the sides to the bowl again', 'using an ice cream scoop , scoop evenly rounded balls of dough and place of cookie sheet about 1 - 2 inches apart to allow for spreading during baking', 'bake for 10 - 15 minutes or until golden brown on the outside and soft & chewy in the center', 'serve hot and enjoy !']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | this is the recipe that we use at my school cafeteria for chocolate chip cookies. they must be the best chocolate chip cookies i have ever had! if you don't have margarine or don't like it, then just use butter (softened) instead.                                                                                                                                            | ['white sugar', 'brown sugar', 'salt', 'margarine', 'eggs', 'vanilla', 'water', 'all-purpose flour', 'whole wheat flour', 'baking soda', 'chocolate chips']                                                                             |              11 |            5 |      595.1 |                46 |           211 |             22 |              13 |                    51 |                    26 |       4 | spring   |
|  2 | 412 broccoli casserole               | 306168 |        40 |            50969 | 2008-05-30 00:00:00 | ['60-minutes-or-less', 'time-to-make', 'course', 'main-ingredient', 'preparation', 'side-dishes', 'vegetables', 'easy', 'beginner-cook', 'broccoli']                                                                                                                                               | [194.8, 20.0, 6.0, 32.0, 22.0, 36.0, 3.0]     |         6 | ['preheat oven to 350 degrees', 'spray a 2 quart baking dish with cooking spray , set aside', 'in a large bowl mix together broccoli , soup , one cup of cheese , garlic powder , pepper , salt , milk , 1 cup of french onions , and soy sauce', 'pour into baking dish , sprinkle remaining cheese over top', 'bake for 25 minutes or until cheese is lightly browned', 'sprinkle with rest of french fried onions and bake until onions are browned and cheese is bubbly , about 10 more minutes']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | since there are already 411 recipes for broccoli casserole posted to "zaar" ,i decided to call this one  #412 broccoli casserole.i don't think there are any like this one in the database. i based this one on the famous "green bean casserole" from campbell's soup. but i think mine is better since i don't like cream of mushroom soup.submitted to "zaar" on may 28th,2008 | ['frozen broccoli cuts', 'cream of chicken soup', 'sharp cheddar cheese', 'garlic powder', 'ground black pepper', 'salt', 'milk', 'soy sauce', 'french-fried onions']                                                                   |               9 |            5 |      194.8 |                20 |             6 |             32 |              22 |                    36 |                     3 |       5 | spring   |
|  3 | millionaire pound cake               | 286009 |       120 |           461724 | 2008-02-12 00:00:00 | ['time-to-make', 'course', 'cuisine', 'preparation', 'occasion', 'north-american', 'desserts', 'american', 'southern-united-states', 'dinner-party', 'holiday-event', 'cakes', 'dietary', 'christmas', 'thanksgiving', 'low-sodium', 'low-in-something', 'taste-mood', 'sweet', '4-hours-or-less'] | [878.3, 63.0, 326.0, 13.0, 20.0, 123.0, 39.0] |         7 | ['freheat the oven to 300 degrees', 'grease a 10-inch tube pan with butter , dust the bottom and sides with flour , and set aside', 'in a large mixing bowl , cream the butter and sugar with an electric mixer and add the eggs one at a time , beating after each addition', 'alternately add the flour and milk , stirring till the batter is smooth', 'add the two extracts and stir till well blended', 'scrape the batter into the prepared pan and bake till a cake tester or knife blade inserted in the center comes out clean , about 1 1 / 2 hours', 'cool the cake in the pan on a rack for 5 minutes , then turn it out on the rack to cool completely']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | why a millionaire pound cake?  because it's super rich!  this scrumptious cake is the pride of an elderly belle from jackson, mississippi.  the recipe comes from "the glory of southern cooking" by james villas.                                                                                                                                                                | ['butter', 'sugar', 'eggs', 'all-purpose flour', 'whole milk', 'pure vanilla extract', 'almond extract']                                                                                                                                |               7 |            5 |      878.3 |                63 |           326 |             13 |              20 |                   123 |                    39 |       2 | winter   |
|  4 | 2000 meatloaf                        | 475785 |        90 |          2202916 | 2012-03-06 00:00:00 | ['time-to-make', 'course', 'main-ingredient', 'preparation', 'main-dish', 'potatoes', 'vegetables', '4-hours-or-less', 'meatloaf', 'simply-potatoes2']                                                                                                                                             | [267.0, 30.0, 12.0, 12.0, 29.0, 48.0, 2.0]    |        17 | ['pan fry bacon , and set aside on a paper towel to absorb excess grease', 'mince yellow onion , red bell pepper , and add to your mixing bowl', 'chop garlic and set aside', 'put 1tbsp olive oil into a saut pan , along with chopped garlic , teaspoons white pepper and a pinch of kosher salt', 'bring to a medium heat to sweat your garlic', 'preheat oven to 350f', 'coarsely chop your baby spinach add to your heated pan , stir frequently for approximately 5 min to wilt', 'add your spinach to the mixing bowl', 'chop your now cooled bacon , and add it to the mixing bowl', 'add your meatloaf mix to the bowl , with one egg and mix till thoroughly combined', 'add your goat cheese , one egg , 1 / 8 tsp white pepper and 1 / 8 tsp of kosher salt and mix till thoroughly combined', 'transfer to a 9x5 meatloaf pan , and cook for 60 min or until the internal temperature is at least 160f', 'let stand for 5min', 'melt 1tbsp unsalted butter into a frying pan , and cook up to three eggs at a time', 'crack each egg into a separate dish , in order to prevent egg shells from reaching the pan , then add salt and pepper to taste', 'wait until the egg whites are firm looking , but slightly runny on top before flipping your eggs', 'after flipping , wait 10~20 seconds before removing each egg and placing it over your slices of meatloaf'] | ready, set, cook! special edition contest entry: a mediterranean flavor inspired meatloaf dish. featuring: simply potatoes - shredded hash browns, egg, bacon, spinach, red bell pepper, and goat cheese.                                                                                                                                                                         | ['meatloaf mixture', 'unsmoked bacon', 'goat cheese', 'unsalted butter', 'eggs', 'baby spinach', 'yellow onion', 'red bell pepper', 'simply potatoes shredded hash browns', 'fresh garlic', 'kosher salt', 'white pepper', 'olive oil'] |              13 |            5 |      267   |                30 |            12 |             12 |              29 |                    48 |                     2 |       3 | spring   |

### Univariate Analysis

### Bivariate Analysis

### Interesting Aggregates

## Assessment of Missingness

After performing some analysis on the 'Avg Rating' column of our dataframe while assessing missingness, we found that the average time taken for a recipe with a missing 'avg rating' was 228 minutes. Alternatively, the average time for a recipe for which 'avg rating' was NOT missing was 111 minutes. Seeing this difference, we performed a permutation test to assess whether 'avg rating' was really dependent on this column. 

We found, with a p-value of .04, that missingness of 'avg rating' was dependent on 'minutes' with an average observed difference of 117. With a threshold of .05, we can reject the null hypothesis that missingness is not dependent on minutes. This makes the 'avg_rating' column MAR. 

With a p-value of .1, we also found that missingness is likely not dependent on protein value. With a threshold of .05 again, we fail to reject the null hypothesis that missingess of 'avg rating' is not dependent on protein value. 

Below is a graph displaying the proportion of missing values with respect to minutes. We can see that missingess increases by a factor of 2 as recipes get longer.

<iframe
  src="plots/missingessbyminutes.html"
  width="800"
  height="600"
  frameborder="0"
></iframe>

## Hypothesis Testing

Hypotheses:
- Null hypothesis: Protein values in recipes submitted during cold months are the same as recipes submitted in warm months.

- Alternative hypothesis: Protein values in recipes submitted during cold months are different than recipes submitted during warm months.

- Test statistic: Absolute difference between protein value averages of warm months and cold months.

- P-value Threshold: 0.05

We performed a permutation test to find the differences in the distributions of protein values in cold and warm months. Warm months were classified as March-September and cold months were all others. We found an observed difference of .3 grams and a p-value of .11. With our threshold of .05, we fail to reject the null hypothesis. We chose this pair of hypotheses to test because of personal interest in this question as well as its applicability in helping us greater understand the ditributions of nutritional values in this dataset. 

Below is a boxplot displaying the distribution of protein in warm vs. cold months. It highlights the lack of difference between the two seasons. 
<iframe
  src="plots/proteinbyseason.html"
  width="800"
  height="600"
  frameborder="0"
></iframe>

## Framing a Prediction Problem

After cleaning/exploring the dataset and analyzing missingness, distributions, and more, we decided to aim to predict calorie value from other nutritional values. At the time of prediction, we will have all the data necessary to predict this value. This is a multiple regression problem whose response variable is 'calorie'. We plan to use Mean Squared Error and R<sup>2</sup> for the following reasons:

1. MSE directly measures prediction accuracy by penalizing larger errors more heavily, which is important when predicting nutritional values where significant deviations could be problematic.
2.  R² indicates how well the other nutritional values explain the variance in calories, providing insight into the relationship's strength.
3. These metrics are more interpretable than alternatives like MAE or RMSE for nutrition prediction, as they relate directly to explained variance and error magnitude in calorie predictions.
